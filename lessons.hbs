{{!< default}}
{{!-- Course Lesson Template --}}
{{!-- Use this from Post → Settings → Template → "Course lesson" --}}

{{#post}}

    {{!-- Body class so your existing CSS can hook into it --}}
    {{#contentFor "body-class"}}
        post-template-course post-has-sidebar
        {{#> "with-sidebar"}} post-has-sidebar{{/"with-sidebar"}}
        {{#unless access}} post-locked{{/unless}}
    {{/contentFor}}

    {{!-- ====================== --}}
    {{!-- HERO + BREADCRUMB      --}}
    {{!-- ====================== --}}
    <header class="course-lesson-hero container-wide">
        <nav class="course-lesson-breadcrumb" aria-label="Breadcrumb">
            <a href="{{@site.url}}">Home</a>
            <span class="sep">›</span>
            <a href="{{@site.url}}/courses/">Courses</a>
            {{#if primary_tag}}
                <span class="sep">›</span>
                <a href="{{@site.url}}/course/{{primary_tag.slug}}/">
                    {{primary_tag.name}}
                </a>
            {{/if}}
            <span class="sep">›</span>
            <span class="current">{{title}}</span>
        </nav>

        <div class="course-lesson-hero-inner">
            <div class="course-lesson-hero-main">
                <h1 class="post-title course-lesson-title">{{title}}</h1>

                <ul class="post-meta course-lesson-meta">
                    {{#if primary_tag}}
                        <li class="meta-pill meta-pill--course">
                            {{primary_tag.name}}
                        </li>
                    {{/if}}

                    {{#if authors}}
                        {{> "post/meta-author"}}
                        <li class="separator">&bull;</li>
                    {{/if}}

                    <li>
                        <time class="post-meta-date" datetime="{{date format="YYYY-MM-DD"}}">
                            {{date format="MMMM D, YYYY"}}
                        </time>
                    </li>

                    {{#if reading_time}}
                        <li class="separator">&bull;</li>
                        <li>
                            <span class="post-meta-time">
                                {{reading_time minute=(t "1 min read") minutes=(t "% min read")}}
                            </span>
                        </li>
                    {{/if}}
                </ul>
            </div>

            <div class="course-lesson-hero-actions">
                {{> "post/button-comments"}}
                {{> "post/button-share"}}
            </div>
        </div>
    </header>

    {{!-- ====================== --}}
    {{!-- MAIN LESSON LAYOUT     --}}
    {{!-- ====================== --}}
    <main class="course-lesson-layout container-wide">
        <div class="course-lesson-grid">

            {{!-- ========= LEFT: LESSON CONTENT ========= --}}
            <article class="course-lesson-main">
                {{!-- Featured image / video --}}
                {{> "post/media"}}

                {{!-- Lesson content --}}
                <div class="course-lesson-content">
                    {{> "post/content"}}
                </div>

                {{!-- Read next inside the course --}}
                <section class="course-lesson-read-next">
                    {{> "post/read-next"}}
                </section>

                {{!-- Subscription (mobile first) --}}
                <section class="course-lesson-subscription">
                    {{> "sections/subscription"}}
                </section>

                {{!-- Comments --}}
                <section class="course-lesson-comments">
                    {{> "post/comments"}}
                </section>
            </article>

            {{!-- ========= RIGHT: COURSE SIDEBAR ========= --}}
            <aside class="course-lesson-sidebar" aria-label="Course sidebar">

                {{!-- COURSE CARD (pulled from primary_tag) --}}
                {{#if primary_tag}}
                    <section class="course-card">
                        {{#if primary_tag.feature_image}}
                            <div class="course-card-cover">
                                <img src="{{primary_tag.feature_image}}" alt="{{primary_tag.name}}">
                            </div>
                        {{/if}}

                        <div class="course-card-body">
                            <h2 class="course-card-title">{{primary_tag.name}}</h2>

                            {{#if primary_tag.description}}
                                <p class="course-card-description">
                                    {{primary_tag.description}}
                                </p>
                            {{/if}}

                            {{!-- Optional difficulty / level via internal tags e.g. #beginner / #intermediate / #advanced --}}
                            <div class="course-card-meta">
                                {{#foreach tags visibility="internal"}}
                                    {{#has slug="beginner"}}
                                        <span class="meta-pill meta-pill--level">Beginner</span>
                                    {{/has}}
                                    {{#has slug="intermediate"}}
                                        <span class="meta-pill meta-pill--level">Intermediate</span>
                                    {{/has}}
                                    {{#has slug="advanced"}}
                                        <span class="meta-pill meta-pill--level">Advanced</span>
                                    {{/has}}
                                {{/foreach}}
                            </div>
                        </div>
                    </section>
                {{/if}}

                {{!-- CURRICULUM: ALL LESSONS IN THIS COURSE --}}
                <section class="course-curriculum">
                    <header class="course-curriculum-header">
                        <h2 class="course-curriculum-title">Course curriculum</h2>
                        {{!-- Optional total count shown after #get --}}
                        {{!-- We’ll fill this dynamically below --}}
                    </header>

                    {{#if primary_tag}}
                        {{#get
                            "posts"
                            filter="primary_tag:{{primary_tag.slug}}+tag:hash-lesson"
                            include="authors,tags"
                            order="published_at asc"
                            limit="50"}}

                            {{#if posts}}
                                <ol class="course-curriculum-list">
                                    {{#foreach posts}}
                                        <li class="course-curriculum-item{{#match id ../id}} is-current{{/match}}">
                                            <a href="{{url}}" class="course-curriculum-link">
                                                <span class="course-curriculum-index">
                                                    {{@number}}.
                                                </span>
                                                <span class="course-curriculum-text">
                                                    <span class="course-curriculum-lesson-title">
                                                        {{title}}
                                                    </span>
                                                    <span class="course-curriculum-lesson-meta">
                                                        {{#if reading_time}}
                                                            {{reading_time minute=(t "1 min") minutes=(t "% min")}}
                                                        {{/if}}
                                                    </span>
                                                </span>
                                            </a>
                                        </li>
                                    {{/foreach}}
                                </ol>
                            {{else}}
                                <p class="course-curriculum-empty">
                                    Lessons will appear here once you add them to this course.
                                </p>
                            {{/if}}

                        {{/get}}
                    {{/if}}
                </section>

                {{!-- OPTIONAL: sticky mini subscription / CTA --}}
                <section class="course-lesson-sidebar-cta">
                    {{!-- You can replace this with your own partial if you want --}}
                    <p>Enjoying this course? Share it with a friend or bookmark it for later.</p>
                </section>

            </aside>
        </div>
    </main>

{{/post}}
<style>
.course-lesson-hero {
  margin-top: 2rem;
  margin-bottom: 2rem;
}

.course-lesson-breadcrumb {
  font-size: 0.875rem;
  margin-bottom: 1rem;
  display: flex;
  flex-wrap: wrap;
  gap: 0.25rem;
}

.course-lesson-breadcrumb a {
  text-decoration: none;
}

.course-lesson-breadcrumb .sep {
  opacity: .6;
}

.course-lesson-hero-inner {
  display: flex;
  justify-content: space-between;
  gap: 2rem;
  align-items: flex-start;
  flex-wrap: wrap;
}

.course-lesson-layout {
  margin-bottom: 4rem;
}

.course-lesson-grid {
  display: grid;
  grid-template-columns: minmax(0, 2.2fr) minmax(0, 1fr);
  gap: 2.5rem;
}

.course-lesson-main {
  min-width: 0;
}

.course-lesson-sidebar {
  min-width: 0;
}

/* Pills */
.meta-pill {
  display: inline-flex;
  align-items: center;
  padding: 0.15rem 0.6rem;
  border-radius: 999px;
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.04em;
}

.meta-pill--course {
  border: 1px solid var(--color-border);
}

.meta-pill--level {
  border: 1px solid var(--color-border);
}

/* Course card */
.course-card {
  border: 1px solid var(--color-border);
  border-radius: var(--radius-3, 12px);
  overflow: hidden;
  margin-bottom: 1.5rem;
}

.course-card-cover img {
  display: block;
  width: 100%;
  height: auto;
}

.course-card-body {
  padding: 1.25rem 1.25rem 1rem;
}

/* Curriculum list */
.course-curriculum {
  border: 1px solid var(--color-border);
  border-radius: var(--radius-3, 12px);
  padding: 1rem 1rem 0.75rem;
}

.course-curriculum-header {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  margin-bottom: 0.75rem;
}

.course-curriculum-title {
  font-size: 0.95rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

.course-curriculum-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.course-curriculum-item {
  border-top: 1px dashed var(--color-border);
}

.course-curriculum-item:first-child {
  border-top: none;
}

.course-curriculum-link {
  display: flex;
  padding: 0.55rem 0.25rem;
  gap: 0.6rem;
  text-decoration: none;
}

.course-curriculum-index {
  font-size: 0.75rem;
  opacity: .7;
  width: 1.5rem;
}

.course-curriculum-lesson-title {
  font-size: 0.9rem;
}

.course-curriculum-lesson-meta {
  font-size: 0.75rem;
  opacity: .65;
}

/* Current lesson highlight */
.course-curriculum-item.is-current .course-curriculum-link {
  background: var(--color-background-100);
  font-weight: 600;
}

/* Responsive */
@media (max-width: 900px) {
  .course-lesson-grid {
    grid-template-columns: minmax(0, 1fr);
  }

  .course-lesson-sidebar {
    order: -1;
  }
}
</style>