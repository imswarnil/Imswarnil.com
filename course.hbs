{{#contentFor "body-class"}} post-template-course{{/contentFor}}

{{!-- 
    COURSE STYLES 
    (Scoped to this template to avoid affecting the blog)
--}}
<style>
    /* --- Layout --- */
    .course-container {
        max-width: var(--container-wide--width);
        margin: 0 auto;
        padding: 0 var(--spacing-5);
    }

    .course-grid {
        display: grid;
        grid-template-columns: 1fr 380px;
        gap: var(--spacing-9);
        margin-top: var(--spacing-9);
        align-items: start;
    }

    /* --- Hero Section --- */
    .course-hero {
        background-color: var(--color-background-100);
        border-radius: var(--radius-5);
        padding: var(--spacing-9);
        border: 1px solid var(--color-border);
        margin-top: var(--spacing-8);
        position: relative;
        overflow: hidden;
    }
    
    .hero-inner {
        display: grid;
        grid-template-columns: 1.4fr 0.6fr;
        gap: var(--spacing-9);
        align-items: center;
        position: relative;
        z-index: 2;
    }

    /* Decorative BG */
    .hero-bg {
        position: absolute; inset: 0; pointer-events: none; z-index: 1;
        background-image: radial-gradient(circle at top right, rgba(0,0,0,0.03) 0%, transparent 60%);
    }

    .course-badge {
        display: inline-flex; align-items: center; gap: 6px;
        padding: 6px 12px; border-radius: 20px;
        background: var(--color-background);
        border: 1px solid var(--color-border);
        font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;
        color: var(--ghost-accent-color); margin-bottom: var(--spacing-5);
    }

    .course-title {
        font-size: clamp(2rem, 4vw, 3rem);
        font-weight: 800; line-height: 1.1;
        color: var(--color-contrast); margin-bottom: var(--spacing-4);
    }

    .course-excerpt {
        font-size: 1.15rem; line-height: 1.6;
        color: var(--color-secondary); margin-bottom: var(--spacing-7);
    }

    .course-poster-wrap {
        position: relative; border-radius: var(--radius-4);
        overflow: hidden; box-shadow: var(--shadow);
        aspect-ratio: 4/3; background: #000;
    }
    .course-poster-wrap img { width: 100%; height: 100%; object-fit: cover; }

    /* --- Curriculum List --- */
    .curriculum-section { margin-top: var(--spacing-9); }
    .curriculum-header {
        display: flex; justify-content: space-between; align-items: flex-end;
        margin-bottom: var(--spacing-6); padding-bottom: var(--spacing-4);
        border-bottom: 1px solid var(--color-border);
    }
    .curriculum-stats { font-size: 0.9rem; color: var(--color-secondary); }

    .lesson-card {
        display: flex; align-items: center;
        padding: var(--spacing-4);
        background-color: var(--color-background);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-3);
        text-decoration: none;
        margin-bottom: var(--spacing-3);
        transition: all 0.2s ease;
    }
    .lesson-card:hover {
        border-color: var(--color-contrast);
        transform: translateY(-2px);
        background-color: var(--color-background-100);
    }

    .lesson-num {
        font-size: 1.2rem; font-weight: 800; color: var(--color-border);
        width: 40px; text-align: center; flex-shrink: 0;
    }
    
    .lesson-thumb {
        width: 100px; height: 60px; border-radius: var(--radius-2);
        object-fit: cover; margin-right: var(--spacing-5);
        background-color: var(--color-background-300); flex-shrink: 0;
    }

    .lesson-info { flex: 1; min-width: 0; }
    .lesson-name { 
        display: block; font-weight: 600; color: var(--color-contrast); 
        font-size: 1rem; margin-bottom: 4px;
        white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .lesson-meta { display: flex; gap: 10px; font-size: 0.75rem; color: var(--color-secondary); }

    .lesson-status {
        width: 32px; height: 32px; border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        background: var(--color-background-200); color: var(--color-secondary);
        margin-left: var(--spacing-4); flex-shrink: 0;
    }
    .lesson-card.unlocked .lesson-status {
        background: var(--ghost-accent-color); color: #fff;
    }

    /* --- Sidebar --- */
    .course-sidebar-sticky { position: sticky; top: 100px; }
    
    .info-card {
        background: var(--color-background-100);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-4);
        padding: var(--spacing-7);
    }

    .price-tag {
        font-size: 2rem; font-weight: 800; color: var(--color-contrast);
        margin-bottom: var(--spacing-2); display: block;
    }
    .price-sub { font-size: 0.85rem; color: var(--color-secondary); margin-bottom: var(--spacing-6); display: block; }

    .feature-list { list-style: none; padding: 0; margin: 0; }
    .feature-list li {
        display: flex; justify-content: space-between; align-items: center;
        padding: 12px 0; border-bottom: 1px solid var(--color-border);
        font-size: 0.9rem; color: var(--color-foreground);
    }
    .feature-list li:last-child { border-bottom: none; }
    .feature-icon { width: 18px; height: 18px; color: var(--color-secondary); margin-right: 8px; vertical-align: middle; }

    /* Instructor */
    .instructor-box {
        margin-top: var(--spacing-7); padding-top: var(--spacing-6);
        border-top: 1px solid var(--color-border);
    }
    .instructor-profile { display: flex; align-items: center; gap: 12px; }
    .instructor-img { width: 48px; height: 48px; border-radius: 50%; object-fit: cover; }

    /* --- Responsive --- */
    @media (max-width: 991px) {
        .course-grid { grid-template-columns: 1fr; }
        .hero-inner { grid-template-columns: 1fr; }
        .course-poster-wrap { order: -1; max-width: 500px; margin-bottom: var(--spacing-6); }
        .course-sidebar { order: 2; }
        
        .lesson-thumb { width: 70px; height: 50px; margin-right: 12px; }
        .lesson-num { display: none; } /* Hide number on mobile to save space */
    }
</style>

{{!-- 1. HERO SECTION --}}
<div class="course-container">
    <div class="course-hero">
        <div class="hero-bg"></div>
        <div class="hero-inner">
            {{!-- Text --}}
            <div class="hero-text">
                <div class="course-badge">
                    {{#if primary_tag}}{{primary_tag.name}}{{else}}{{t "Course"}}{{/if}}
                </div>
                <h1 class="course-title">{{title}}</h1>
                <p class="course-excerpt">{{custom_excerpt}}</p>
                
                <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: var(--spacing-7);">
                    <a href="#curriculum" class="button button-rounded">
                        {{t "Start Learning"}}
                        <svg style="width:18px; height:18px; margin-left:8px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                    </a>
                    {{!-- Optional Share Button --}}
                    <button class="button button-rounded button-transparent" data-popup-toggle="#popup-share">
                        {{t "Share"}}
                        <svg style="width:18px; height:18px; margin-left:8px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" y1="2" x2="12" y2="15"></line></svg>
                    </button>
                </div>
            </div>

            {{!-- Image --}}
            <div class="hero-media">
                <div class="course-poster-wrap">
                    {{#if feature_image}}
                        <img src="{{img_url feature_image size="l"}}" alt="{{title}}">
                    {{else}}
                        <div style="width:100%; height:100%; background:var(--color-background-200);"></div>
                    {{/if}}
                </div>
            </div>
        </div>
    </div>
</div>

{{!-- 2. MAIN GRID --}}
<div class="course-container">
    <div class="course-grid">
        
        {{!-- LEFT: Main Content --}}
        <div class="course-content">
            
            {{!-- Ad Slot (Top) --}}
            <div class="gh-ad gh-ad--leaderboard" style="margin-bottom: var(--spacing-8);">
                {{!-- Insert Ad Code Here if needed --}}
            </div>

            {{!-- About Content --}}
            <div class="post-content">
                <h2>{{t "About this Course"}}</h2>
                {{content}}
            </div>

            {{!-- Curriculum --}}
            <div id="curriculum" class="curriculum-section">
                
                {{!-- Fetch Lessons --}}
                {{#get "posts" filter="tags:hash-lesson+tags:{{primary_tag.slug}}" order="published_at asc" include="tags"}}
                
                <div class="curriculum-header">
                    <h2 style="margin:0;">{{t "Curriculum"}}</h2>
                    <span class="curriculum-stats">{{pagination.total}} {{t "Lessons"}}</span>
                </div>

                <div class="curriculum-list">
                    {{#foreach posts}}
                    <a href="{{url}}" class="lesson-card {{#if access}}unlocked{{/if}}">
                        <span class="lesson-num">{{@number}}</span>
                        
                        {{#if feature_image}}
                            <img src="{{img_url feature_image size="xs"}}" class="lesson-thumb" alt="">
                        {{else}}
                            <div class="lesson-thumb" style="display:flex; align-items:center; justify-content:center;">
                                <svg width="24" height="24" fill="none" stroke="currentColor" opacity="0.3"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                            </div>
                        {{/if}}

                        <div class="lesson-info">
                            <span class="lesson-name">{{title}}</span>
                            <div class="lesson-meta">
                                {{!-- Reading time / Duration --}}
                                <span>{{reading_time}}</span>
                                {{!-- Internal Tags --}}
                                {{#foreach tags visibility="internal"}}
                                    {{#match slug "~^" "hash-lesson-duration-"}}
                                        <span>&bull; {{description}}</span>
                                    {{/match}}
                                {{/foreach}}
                            </div>
                        </div>

                        {{!-- Lock/Play Icon --}}
                        <div class="lesson-status">
                            {{#if access}}
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                            {{else}}
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                            {{/if}}
                        </div>
                    </a>
                    {{/foreach}}
                </div>
                {{/get}}
            </div>

            {{!-- Ad Slot (Bottom) --}}
            <div class="gh-ad gh-ad--rectangle" style="margin-top: var(--spacing-9);">
               {{!-- Insert Ad Code --}}
            </div>

        </div>

        {{!-- RIGHT: Sidebar --}}
        <aside class="course-sidebar">
            <div class="course-sidebar-sticky">
                <div class="info-card">
                    
                    {{!-- Price / Access --}}
                    <span class="price-tag">{{#if access}}Free{{else}}Premium{{/if}}</span>
                    <span class="price-sub">
                        {{#if access}}{{t "Open to everyone"}}{{else}}{{t "Requires subscription"}}{{/if}}
                    </span>

                    <ul class="feature-list">
                        {{!-- Dynamic Internal Meta Tags from Course Post --}}
                        {{#foreach tags visibility="internal"}}
                            {{#match slug "~^" "hash-course-duration-"}}
                            <li>
                                <span><svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> {{t "Duration"}}</span>
                                <strong>{{description}}</strong>
                            </li>
                            {{/match}}
                            {{#match slug "~^" "hash-course-level-"}}
                            <li>
                                <span><svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg> {{t "Level"}}</span>
                                <strong>{{description}}</strong>
                            </li>
                            {{/match}}
                        {{/foreach}}
                        
                        <li>
                            <span><svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg> {{t "Last Updated"}}</span>
                            <strong>{{date format="MMM YYYY"}}</strong>
                        </li>
                        <li>
                            <span><svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg> {{t "Certificate"}}</span>
                            <strong>{{t "Yes"}}</strong>
                        </li>
                    </ul>

                    {{!-- Instructor --}}
                    <div class="instructor-box">
                        <h4 style="font-size:0.85rem; text-transform:uppercase; color:var(--color-secondary); margin-bottom:12px;">{{t "Instructor"}}</h4>
                        {{#foreach authors}}
                        <div class="instructor-profile">
                            <a href="{{url}}">
                                {{#if profile_image}}
                                    <img src="{{img_url profile_image}}" class="instructor-img" alt="{{name}}">
                                {{else}}
                                    <span class="avatar avatar-large" style="display:block; text-align:center; line-height:48px; background:var(--color-background-200);">{{name.[0]}}</span>
                                {{/if}}
                            </a>
                            <div>
                                <a href="{{url}}" style="font-weight:bold; color:var(--color-contrast); text-decoration:none; display:block;">{{name}}</a>
                                <span style="font-size:0.8rem; color:var(--color-secondary);">{{location}}</span>
                            </div>
                        </div>
                        {{/foreach}}
                    </div>

                </div>
            </div>
        </aside>

    </div>
</div>