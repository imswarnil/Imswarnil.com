{{#contentFor "body-class"}} post-template-episode{{/contentFor}}
{{!-- Copy style from post-lesson.hbs --}}
<style>
    .lesson-layout { display: grid; grid-template-columns: 1fr 340px; gap: var(--spacing-9); margin-top: var(--spacing-8); align-items: start; }
    .timeline-wrapper { background: var(--color-background-100); padding: var(--spacing-6); border-radius: var(--radius-4); border: 1px solid var(--color-border); max-height: 80vh; overflow-y: auto; }
    .timeline-list { list-style: none; margin: 0; padding: 0; position: relative; }
    .timeline-list::before { content: ''; position: absolute; top: 10px; bottom: 10px; left: 7px; width: 2px; background: var(--color-border); z-index: 0; }
    .timeline-item { position: relative; padding-left: 28px; margin-bottom: 14px; z-index: 1; }
    .timeline-dot { position: absolute; left: 0; top: 6px; width: 16px; height: 16px; border-radius: 50%; background: var(--color-background); border: 2px solid var(--color-border); }
    .timeline-link { text-decoration: none; color: var(--color-foreground); font-size: 0.9rem; display: block; line-height: 1.4; }
    .timeline-item.current .timeline-dot { background: var(--ghost-accent-color); border-color: var(--ghost-accent-color); }
    .timeline-item.current .timeline-link { font-weight: 700; color: var(--color-contrast); }
    @media (max-width: 991px) { .lesson-layout { grid-template-columns: 1fr; } .lesson-sidebar { order: 2; } }
</style>

<div class="container-wide">
    <div class="lesson-layout">
        <div class="lesson-content">
            <header class="lesson-header" style="margin-bottom: var(--spacing-7);">
                {{#if primary_tag}}
                    {{#get "posts" filter=(concat "tags:hash-webseries+tags:" primary_tag.slug) limit="1"}}
                        {{#foreach posts}}
                        <a href="{{url}}" style="text-decoration:none; display:inline-block; margin-bottom:var(--spacing-3); color:var(--color-secondary);">← {{t "Back to Series"}}</a>
                        {{/foreach}}
                    {{/get}}
                {{/if}}
                <h1 class="post-title">{{title}}</h1>
            </header>
            {{#if feature_image}}<div class="post-media" style="margin-bottom: var(--spacing-7);"><figure class="post-featured-image"><img src="{{img_url feature_image}}" alt="{{title}}"></figure></div>{{/if}}
            <div class="post-content">{{content}}</div>
            <div style="display: flex; justify-content: space-between; margin-top: var(--spacing-9); padding-top: var(--spacing-6); border-top: 1px solid var(--color-border);">
                {{#prev_post in="primary_tag"}}<a href="{{url}}" class="button button-transparent">← {{t "Previous"}}</a>{{/prev_post}}
                {{#next_post in="primary_tag"}}<a href="{{url}}" class="button">{{t "Next"}} →</a>{{/next_post}}
            </div>
        </div>
        <aside class="lesson-sidebar" style="position: sticky; top: 100px;">
            <div class="timeline-wrapper">
                <h3 style="font-size: 1rem; margin: 0 0 var(--spacing-5) 0;">{{#if primary_tag}}{{primary_tag.name}}{{else}}Episodes{{/if}}</h3>
                {{#if primary_tag}}
                    {{#get "posts" filter=(concat "tags:hash-episode+tags:" primary_tag.slug) order="published_at asc"}}
                        <ul class="timeline-list">
                            {{#foreach posts}}
                                <li class="timeline-item {{#if current}}current{{/if}}">
                                    <span class="timeline-dot"></span>
                                    <a href="{{url}}" class="timeline-link">{{title}}</a>
                                </li>
                            {{/foreach}}
                        </ul>
                    {{/get}}
                {{/if}}
            </div>
        </aside>
    </div>
</div>