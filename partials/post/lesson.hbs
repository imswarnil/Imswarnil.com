<style>
    /* --- LAYOUT --- */
    .lesson-container {
        max-width: var(--container-wide--width);
        margin: 0 auto;
        padding: var(--spacing-8) var(--layout--padding);
        display: flex;
        flex-direction: column;
        gap: var(--spacing-8);
    }

    /* --- HEADER & MEDIA --- */
    .lesson-header {
        margin-bottom: var(--spacing-6);
    }

    .lesson-breadcrumb {
        margin-bottom: var(--spacing-4);
        font-size: var(--font-small);
        font-weight: var(--font-weight-medium);
    }

    .lesson-breadcrumb a {
        color: var(--color-secondary);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 5px;
        transition: color 0.2s;
    }

    .lesson-breadcrumb a:hover { color: var(--ghost-accent-color); }

    .lesson-title {
        font-family: var(--font-family-headings);
        font-size: clamp(1.75rem, 3vw, 2.5rem);
        font-weight: var(--font-weight-bold);
        line-height: 1.1;
        color: var(--color-contrast);
        margin: 0 0 var(--spacing-4) 0;
    }

    .lesson-media-wrapper {
        width: 100%;
        border-radius: var(--radius-4);
        overflow: hidden;
        background: #000;
        box-shadow: var(--shadow);
        margin-bottom: var(--spacing-8);
    }
    
    .lesson-media-wrapper img,
    .lesson-media-wrapper video,
    .lesson-media-wrapper iframe {
        width: 100%;
        height: auto;
        aspect-ratio: 16/9;
        object-fit: cover;
        display: block;
    }

    /* --- SPLIT GRID --- */
    .lesson-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--spacing-9);
        align-items: start;
    }

    @media (min-width: 992px) {
        .lesson-grid {
            grid-template-columns: 1fr 340px; /* Content vs Sidebar */
        }
    }

    /* --- SIDEBAR CURRICULUM --- */
    .lesson-sidebar-sticky {
        position: sticky;
        top: 100px;
        display: flex;
        flex-direction: column;
        gap: var(--spacing-6);
    }

    .course-nav-card {
        background: var(--color-background);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-4);
        overflow: hidden;
        max-height: 80vh;
        display: flex;
        flex-direction: column;
    }

    .course-nav-header {
        padding: var(--spacing-5);
        background: var(--color-background-100);
        border-bottom: 1px solid var(--color-border);
        flex-shrink: 0;
    }

    .course-nav-header h4 {
        margin: 0;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--color-secondary);
        font-weight: 700;
    }

    .course-nav-header .course-name {
        display: block;
        font-size: 1rem;
        font-weight: var(--font-weight-bold);
        color: var(--color-contrast);
        margin-top: 5px;
        text-decoration: none;
    }

    .lesson-nav-list {
        list-style: none;
        padding: 0;
        margin: 0;
        overflow-y: auto;
    }

    .lesson-nav-item a {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 15px 20px;
        border-bottom: 1px solid var(--color-border);
        text-decoration: none;
        color: var(--color-foreground);
        font-size: 0.9rem;
        transition: all 0.15s;
        line-height: 1.4;
    }

    .lesson-nav-item a:hover {
        background-color: var(--color-background-100);
        color: var(--ghost-accent-color);
    }

    /* Active State */
    .lesson-nav-item.current-lesson a {
        background-color: var(--color-background-100);
        color: var(--ghost-accent-color);
        font-weight: var(--font-weight-bold);
        border-left: 4px solid var(--ghost-accent-color);
    }

    .nav-icon {
        width: 18px; height: 18px; flex-shrink: 0; opacity: 0.7;
    }

    /* --- BOTTOM NAVIGATION --- */
    .lesson-footer-nav {
        display: flex;
        justify-content: space-between;
        margin-top: var(--spacing-9);
        padding-top: var(--spacing-6);
        border-top: 1px solid var(--color-border);
        gap: 20px;
    }

    .nav-btn {
        display: flex;
        flex-direction: column;
        text-decoration: none;
        max-width: 45%;
    }

    .nav-btn span {
        font-size: 0.8rem;
        color: var(--color-secondary);
        text-transform: uppercase;
        margin-bottom: 5px;
    }

    .nav-btn strong {
        font-size: 1.1rem;
        color: var(--color-contrast);
        line-height: 1.3;
    }

    .nav-btn:hover strong { color: var(--ghost-accent-color); }
    .nav-btn-next { text-align: right; margin-left: auto; }
</style>

<div class="lesson-container">

    {{!-- 1. BREADCRUMB: Link back to Parent Course --}}
    {{!-- Logic: Find post with same primary tag AND #courses-col tag --}}
    {{#get "posts"
        filter="tag:hash-courses-col+tag:{{primary_tag.slug}}"
        include="tags"
        limit="1"
        as |courses|
    }}
        {{#foreach courses}}
            <nav class="lesson-breadcrumb">
                <a href="{{url}}">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                    Back to {{title}}
                </a>
            </nav>
        {{/foreach}}
    {{/get}}

    {{!-- 2. LESSON TITLE & INFO --}}
    <header class="lesson-header">
        <h1 class="lesson-title">{{title}}</h1>
        <div style="display:flex; gap:15px; font-size:0.9rem; color:var(--color-secondary);">
            {{#if reading_time}}
                <span>‚è±Ô∏è {{reading_time}}</span>
            {{/if}}
            <time datetime="{{date format="YYYY-MM-DD"}}">üìÖ {{date format="MMM D, YYYY"}}</time>
        </div>
    </header>

    {{!-- 3. LESSON MEDIA (Video) --}}
    <div class="lesson-media-wrapper">
        {{> "post/media"}}
    </div>

    {{!-- 4. GRID: Content (Left) vs Navigation (Right) --}}
    <div class="lesson-grid">

        {{!-- LEFT COLUMN --}}
        <div class="lesson-main">
            <article class="post-content">
                {{content}}
            </article>

            {{!-- Navigation Buttons --}}
            <div class="lesson-footer-nav">
                {{#prev_post in="primary_tag"}}
                    <a href="{{url}}" class="nav-btn nav-btn-prev">
                        <span>‚Üê Previous Lesson</span>
                        <strong>{{title}}</strong>
                    </a>
                {{/prev_post}}

                {{#next_post in="primary_tag"}}
                    <a href="{{url}}" class="nav-btn nav-btn-next">
                        <span>Next Lesson ‚Üí</span>
                        <strong>{{title}}</strong>
                    </a>
                {{/next_post}}
            </div>

            <div style="margin-top: 60px;">
                {{> "post/comments"}}
            </div>
        </div>

        {{!-- RIGHT COLUMN: STICKY NAV --}}
        <aside class="lesson-sidebar-sticky">
            <div class="course-nav-card">
                
                {{!-- Header: Parent Course Name --}}
                {{#get "posts" filter="tag:hash-courses-col+tag:{{primary_tag.slug}}" limit="1"}}
                    {{#foreach posts}}
                        <div class="course-nav-header">
                            <h4>Course Outline</h4>
                            <a href="{{url}}" class="course-name">{{title}}</a>
                        </div>
                    {{/foreach}}
                {{/get}}

                {{!-- List: Lessons (Oldest First -> Newest) --}}
                {{#get "posts" 
                    filter="tag:{{primary_tag.slug}}+tag:hash-lessons-col" 
                    include="tags" 
                    order="published_at asc" 
                    limit="100" 
                    as |lessons|
                }}
                    {{#if lessons}}
                        <ul class="lesson-nav-list">
                            {{#foreach lessons}}
                                <li class="lesson-nav-item {{#if (eq id ../../id)}}current-lesson{{/if}}">
                                    <a href="{{url}}">
                                        {{!-- Status Icons --}}
                                        {{#if (eq id ../../id)}}
                                            {{!-- Playing --}}
                                            <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                                        {{else}}
                                            {{#if access}}
                                                {{!-- Unlocked --}}
                                                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle></svg>
                                            {{else}}
                                                {{!-- Locked --}}
                                                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                                            {{/if}}
                                        {{/if}}
                                        
                                        <span>{{title}}</span>
                                    </a>
                                </li>
                            {{/foreach}}
                        </ul>
                    {{/if}}
                {{/get}}
            </div>
        </aside>

    </div>
</div>