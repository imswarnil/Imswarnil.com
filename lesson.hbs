{{!< default}}

{{#post}}
{{#contentFor "body-class"}} post-template-lesson post-has-sidebar{{/contentFor}}

<div class="container-wide">
    <div class="post-content-grid" style="display: grid; grid-template-columns: 1fr 350px; gap: var(--spacing-9);">
        
        {{!-- LEFT: Lesson Content --}}
        <div class="post-content-wrapper">
            
            <header class="post-header">
                {{!-- Link back to the Course Overview --}}
                {{#get "posts" filter="tags:hash-course+tags:{{primary_tag.slug}}" limit="1" as |course|}}
                    {{#foreach course}}
                        <a href="{{url}}" style="font-size: var(--font-small); color: var(--color-secondary); text-decoration: none; display: inline-block; margin-bottom: var(--spacing-4);">
                            &larr; Back to {{title}}
                        </a>
                    {{/foreach}}
                {{/get}}

                <h1 class="post-title">{{title}}</h1>
            </header>

            {{#if feature_image}}
                {{> "post/media"}}
            {{/if}}

            <div class="post-content">
                {{content}}
            </div>

            {{!-- Next/Prev Navigation logic restricted to this primary tag (Course) --}}
            <div class="post-read-next" style="margin-top: var(--spacing-9); display: flex; justify-content: space-between;">
                {{#prev_post in="primary_tag"}}
                    <a href="{{url}}" class="button button-secondary">&larr; Previous Lesson</a>
                {{/prev_post}}
                {{#next_post in="primary_tag"}}
                    <a href="{{url}}" class="button button-primary">Next Lesson &rarr;</a>
                {{/next_post}}
            </div>
        </div>

        {{!-- RIGHT: Sidebar (Lesson List) --}}
        <aside class="post-sidebar">
            <div class="post-sidebar-sticky" style="position: sticky; top: 20px;">
                <div style="background: var(--color-background-100); padding: var(--spacing-6); border-radius: var(--radius-4); border: 1px solid var(--color-border);">
                    <h3 style="font-size: 1.1rem; margin-bottom: var(--spacing-5); padding-bottom: var(--spacing-3); border-bottom: 1px solid var(--color-border);">
                        {{primary_tag.name}}
                    </h3>
                    
                    {{!-- List all lessons in this course --}}
                    {{#get "posts" filter="tags:hash-lesson+tags:{{primary_tag.slug}}" order="published_at asc"}}
                        <ul style="list-style: none; padding: 0; margin: 0;">
                            {{#foreach posts}}
                                <li style="margin-bottom: 10px;">
                                    <a href="{{url}}" style="text-decoration: none; display: block; padding: 5px 0; {{#if current}}color: var(--ghost-accent-color); font-weight: bold;{{else}}color: var(--color-foreground);{{/if}}">
                                        {{#if current}}â–¶ {{/if}}{{title}}
                                    </a>
                                </li>
                            {{/foreach}}
                        </ul>
                    {{/get}}
                </div>
            </div>
        </aside>

    </div>
</div>
{{/post}}