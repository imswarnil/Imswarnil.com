{{!-- 
    PARTIAL: course/lessons-aside
    USAGE: In lesson template sidebar (inside {{#post}})
           {{> "course/lessons-aside"}}
    PURPOSE: Show all lessons in the same course (same primary_tag + #lesson),
             highlight current lesson, show tiny thumb, title, short excerpt.
--}}

{{#if primary_tag}}
    {{#get
        "posts"
        filter=(concat "tag:hash-lesson+tag:" primary_tag.slug)
        include="tags"
        limit="all"
        order="published_at asc"
    }}
        {{#if posts}}
            <nav class="lesson-sidebar-nav toc" aria-label="{{t "Course lessons"}}">
                <h3 class="lesson-sidebar-title toc-title">
                    {{t "Lessons in this course"}}
                </h3>

                <ol class="lesson-sidebar-list toc-list">
                    {{#foreach posts}}
                        {{!-- Compare lesson slug to current page slug (outer post context) --}}
                        {{#match slug ../../slug}}
                            {{!-- ACTIVE LESSON --}}
                            <li class="lesson-sidebar-item toc-list-item is-active is-current">
                                <div class="lesson-sidebar-link toc-link is-current">
                                    <div class="lesson-sidebar-thumb card-post-media card-post-media--small">
                                        {{#if feature_image}}
                                            <img src="{{img_url feature_image size="xs"}}" alt="{{title}}">
                                        {{else}}
                                            <span class="lesson-sidebar-thumb-placeholder">â–¶</span>
                                        {{/if}}
                                    </div>

                                    <div class="lesson-sidebar-text card-post-content">
                                        <div class="lesson-sidebar-topline card-post-header">
                                            <span class="lesson-sidebar-number">
                                                {{@number}}
                                            </span>
                                            <span class="lesson-sidebar-name card-post-title">
                                                {{title}}
                                            </span>
                                        </div>

                                        {{#if custom_excerpt}}
                                            <span class="lesson-sidebar-excerpt card-post-excerpt">
                                                {{custom_excerpt}}
                                            </span>
                                        {{else if excerpt}}
                                            <span class="lesson-sidebar-excerpt card-post-excerpt">
                                                {{excerpt}}
                                            </span>
                                        {{/if}}
                                    </div>

                                    <span class="lesson-sidebar-status lesson-sidebar-status--current card-post-tag">
                                        {{t "Now"}}
                                    </span>
                                </div>
                            </li>
                        {{else}}
                            {{!-- OTHER LESSONS --}}
                            <li class="lesson-sidebar-item toc-list-item">
                                {{#if access}}
                                    <a href="{{url}}" class="lesson-sidebar-link toc-link">
                                        <div class="lesson-sidebar-thumb card-post-media card-post-media--small">
                                            {{#if feature_image}}
                                                <img src="{{img_url feature_image size="xs"}}" alt="{{title}}">
                                            {{else}}
                                                <span class="lesson-sidebar-thumb-placeholder">â–¶</span>
                                            {{/if}}
                                        </div>

                                        <div class="lesson-sidebar-text card-post-content">
                                            <div class="lesson-sidebar-topline card-post-header">
                                                <span class="lesson-sidebar-number">
                                                    {{@number}}
                                                </span>
                                                <span class="lesson-sidebar-name card-post-title">
                                                    {{title}}
                                                </span>
                                            </div>

                                            {{#if custom_excerpt}}
                                                <span class="lesson-sidebar-excerpt card-post-excerpt">
                                                    {{custom_excerpt}}
                                                </span>
                                            {{else if excerpt}}
                                                <span class="lesson-sidebar-excerpt card-post-excerpt">
                                                    {{excerpt}}
                                                </span>
                                            {{/if}}
                                        </div>

                                        <span class="lesson-sidebar-status lesson-sidebar-status--free card-post-tag">
                                            â–¶
                                        </span>
                                    </a>
                                {{else}}
                                    <div class="lesson-sidebar-link toc-link is-locked">
                                        <div class="lesson-sidebar-thumb card-post-media card-post-media--small">
                                            {{#if feature_image}}
                                                <img src="{{img_url feature_image size="xs"}}" alt="{{title}}">
                                            {{else}}
                                                <span class="lesson-sidebar-thumb-placeholder">ðŸ”’</span>
                                            {{/if}}
                                        </div>

                                        <div class="lesson-sidebar-text card-post-content">
                                            <div class="lesson-sidebar-topline card-post-header">
                                                <span class="lesson-sidebar-number">
                                                    {{@number}}
                                                </span>
                                                <span class="lesson-sidebar-name card-post-title">
                                                    {{title}}
                                                </span>
                                            </div>

                                            {{#if custom_excerpt}}
                                                <span class="lesson-sidebar-excerpt card-post-excerpt">
                                                    {{custom_excerpt}}
                                                </span>
                                            {{else if excerpt}}
                                                <span class="lesson-sidebar-excerpt card-post-excerpt">
                                                    {{excerpt}}
                                                </span>
                                            {{/if}}
                                        </div>

                                        <span class="lesson-sidebar-status lesson-sidebar-status--locked card-post-tag">
                                            ðŸ”’
                                        </span>
                                    </div>
                                {{/if}}
                            </li>
                        {{/match}}
                    {{/foreach}}
                </ol>
            </nav>
        {{/if}}
    {{/get}}
{{/if}}
